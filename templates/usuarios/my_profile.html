{% extends 'base.html' %}
{% load static %}

{% block title %}Perfil - {{ user.full_name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Sidebar de Navegação -->
        <div class="col-lg-4 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center p-4">
                    <!-- Avatar -->
                    <div class="mb-4">
                        {% if user.img %}
                            <img src="{{ user.img.thumb.url }}" 
                                 alt="{{ user.full_name }}" 
                                 class="rounded-circle shadow"
                                 style="width: 120px; height: 120px; object-fit: cover;">
                        {% else %}
                            <img src="{% static 'images/default_user.avif' %}" 
                                 alt="{{ user.full_name }}" 
                                 class="rounded-circle shadow"
                                 style="width: 120px; height: 120px; object-fit: cover;">
                        {% endif %}
                    </div>
                    
                    <h4 class="fw-bold text-dark mb-2">{{ user.full_name }}</h4>
                    <p class="text-muted mb-4">{{ user.email }}</p>
                    
                    <!-- Estatísticas Reais -->
                    <div class="row g-2 mb-4">
                        <div class="col-6">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-primary fs-5">{{ user.user_books.count }}</div>
                                <small class="text-muted">Livros</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-success fs-5">{{ user.loan_owner.count }}</div>
                                <small class="text-muted">Empréstimos</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-info fs-5">{{ user.order_borrower.count }}</div>
                                <small class="text-muted">Pedidos Feitos</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-warning fs-5">{{ user.order_owner.count }}</div>
                                <small class="text-muted">Pedidos Recebidos</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navegação Rápida -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-transparent border-0 py-3">
                    <h6 class="fw-bold mb-0 text-primary">
                        <i class="fas fa-rocket me-2"></i>Acesso Rápido
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="d-grid gap-2">
                        <a href="{% url 'books:user_library' pk=user.id %}" class="btn btn-outline-primary btn-sm text-start">
                            <i class="fas fa-book me-2"></i>Minha Biblioteca
                        </a>
                        <a href="{% url 'loans:user_loans_list' %}" class="btn btn-outline-success btn-sm text-start">
                            <i class="fas fa-book-reader me-2"></i>Meus Empréstimos
                        </a>
                        <a href="{% url 'loans:books_loans_list' %}" class="btn btn-outline-info btn-sm text-start">
                            <i class="fas fa-hand-holding me-2"></i>Livros Emprestados
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <div class="col-lg-8">
            <!-- Card de Informações Pessoais -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-0 py-3">
                    <h5 class="fw-bold mb-0 text-primary">
                        <i class="fas fa-user me-2"></i>Informações Pessoais
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label text-muted small fw-semibold">Nome Completo</label>
                            <p class="fw-semibold text-dark mb-0">{{ user.full_name }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small fw-semibold">E-mail</label>
                            <p class="fw-semibold text-dark mb-0">{{ user.email }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small fw-semibold">Telefone</label>
                            <p class="fw-semibold text-dark mb-0">{{ user.telefone|default:"Não informado" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small fw-semibold">Usuário desde</label>
                            <p class="fw-semibold text-dark mb-0">{{ user.date_joined|date:"d/m/Y" }}</p>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-muted small fw-semibold">Último login</label>
                            <p class="fw-semibold text-dark mb-0">{{ user.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Atividade Recente -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 py-3">
                    <h5 class="fw-bold mb-0 text-primary">
                        <i class="fas fa-history me-2"></i>Atividade Recente
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_activity %}
                    <div class="list-group list-group-flush">
                        {% for activity in recent_activity %}
                        <div class="list-group-item border-0 px-0 py-3">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas 
                                        {% if activity.type == 'loan' %}fa-book-reader text-success
                                        {% elif activity.type == 'order' %}fa-handshake text-primary
                                        {% elif activity.type == 'book' %}fa-book text-info
                                        {% else %}fa-bell text-warning{% endif %} 
                                        fa-lg me-3">
                                    </i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-1 fw-semibold">{{ activity.title }}</p>
                                    <small class="text-muted">{{ activity.description }}</small>
                                </div>
                                <div class="flex-shrink-0">
                                    <small class="text-muted">{{ activity.date|timesince }} atrás</small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-chart-line fa-2x text-muted mb-3"></i>
                        <p class="text-muted mb-0">Sua atividade recente aparecerá aqui</p>
                        <small class="text-muted">Pedidos, empréstimos e interações</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Card de Configurações -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-transparent border-0 py-3">
                    <h5 class="fw-bold mb-0 text-primary">
                        <i class="fas fa-cog me-2"></i>Configurações
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <a href="{% url 'account_change_password' %}" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center py-2">
                                <i class="fas fa-lock me-2"></i>
                                <span>Alterar Senha</span>
                            </a>
                        </div>
                        <div class="col-md-6">
                            <a href="{% url 'account_email' %}" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center py-2">
                                <i class="fas fa-envelope me-2"></i>
                                <span>Gerenciar E-mail</span>
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="#" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center py-2">
                                <i class="fas fa-edit me-2"></i>
                                <span>Editar Perfil</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}